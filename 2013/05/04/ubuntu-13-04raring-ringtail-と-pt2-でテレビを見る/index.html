<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ubuntu 13.04(Raring Ringtail) と PT2 でテレビを見る</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="個人的なメモを兼ねたブログです
">
    <link rel="canonical" href="http://blog.h3x.red//2013/05/04/ubuntu-13-04raring-ringtail-%e3%81%a8-pt2-%e3%81%a7%e3%83%86%e3%83%ac%e3%83%93%e3%82%92%e8%a6%8b%e3%82%8b/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/"></a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link" href="/about/">About</a>
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Ubuntu 13.04(Raring Ringtail) と PT2 でテレビを見る</h1>
    <p class="meta">May 4, 2013 • hogetatsu</p>
  </header>

  <article class="post-content">
  <p>pt2の設定方法です。<br />
<!--more--></p>

<h1 id="section">ソフトウェアのセットアップ</h1>

<p>NTT-ME SCR3310-NTTCom(カードリーダー)周りの問題は、<a href="http://schrott.alteseisen.net/2013/01/11/ubuntu-12-10-quantal-quetzal-64%e3%83%93%e3%83%83%e3%83%88%e7%89%88-%e3%81%a8-pt2-%e3%81%a7%e5%9c%b0%e3%83%87%e3%82%b8%e8%a6%8b%e3%81%be%e3%81%97%e3%81%9f%e3%80%82/" title="ubuntu 12.10 (Quantal Quetzal) 64ビット版 と PT2 で地デジ見ました。">前に書いた通り</a>13.04では起こりません。</p>

<p>下記スクリプトを実行後、再起動。<br />
カードリーダー(NTT-ME SCR3310-NTTCom)はLEDが点灯しっぱなしは失敗、点滅していれば成功です。</p>

<p><span style="color: #ff0000;">ubuntu 13.04</span> では下記スクリプトが<span style="color: #ff0000;">コンパイルエラー</span>となり、33行目あたりの<span style="color: #ff0000;">「ここから」「ここまで」のコメントを外す</span>(“#”を削除する)と動きました&lt;/span&gt;。<br />
正しい修正か不明ですが、詳細はこのページの末尾に。</p>

<pre class="brush: bash; title: ; notranslate" title="">#!/bin/bash

# recpt1 installer
# author: hogetatsu
# website: http://schrott.alteseisen.net/

# 作業ディレクトリ
CURRENT_DIR=`pwd`
WORK_DIR=$CURRENT_DIR/pt2_`date +%s`
mkdir $WORK_DIR
cd $WORK_DIR

# インストールに必要なパッケージ
sudo apt-get -y install pkg-config unzip autoconf build-essential linux-headers-`uname -r`

# カードリーダを動かすためのパッケージ
sudo apt-get -y install libccid libpcsclite1 libpcsclite-dev pcsc-tools pcscd
sudo /etc/init.d/pcscd restart

# arib25
wget http://hg.honeyplanet.jp/pt1/archive/ec7c87854f2f.zip
unzip ec7c87854f2f.zip
cd pt1-ec7c87854f2f/arib25/src/
make
sudo make install

# pt2ドライバ
cd $WORK_DIR
wget http://hg.honeyplanet.jp/pt1/archive/tip.tar.bz2
tar jxf tip.tar.bz2
cd `ls -tr | tail -1`/driver

## ここから
## ubuntu13.04 時点でのコンパイルエラーを解消
# sed -i.bk "s/static char version\[\] __devinitdata =/static char version\[\] =/" ./pt1_pci.c
# sed -i "s/static int __devinit pt1_pci_init_one (struct pci_dev \*pdev,/static int pt1_pci_init_one (struct pci_dev \*pdev,/" ./pt1_pci.c
# sed -i "s/static void __devexit pt1_pci_remove_one(struct pci_dev \*pdev)/static void pt1_pci_remove_one(struct pci_dev \*pdev)/" ./pt1_pci.c
# sed -i "s/\t.remove\t\t= __devexit_p(pt1_pci_remove_one),/\t.remove\t\t= pt1_pci_remove_one,/" ./pt1_pci.c
## ここまで

make
sudo make install

# recpt1(録画ソフトウェア)
cd ../recpt1
./autogen.sh
./configure --enable-b25
make
sudo make install

# linuxに最初から入っているpt2ドライバを無効にします
BLACK_LIST=`grep "blacklist earth-pt1" /etc/modprobe.d/blacklist.conf`
if [ -z "$BLACK_LIST" ]; then
    sudo sh -c "echo '' &gt;&gt; /etc/modprobe.d/blacklist.conf"
    sudo sh -c "echo 'blacklist earth-pt1' &gt;&gt; /etc/modprobe.d/blacklist.conf"
fi

# 作業ディレクトリを削除
cd $CURRENT_DIR
echo -n "作業ディレクトリを削除しますか? [y]es, or [n]o: "
read DEL_WORK_DIR
if [ ${DEL_WORK_DIR} = "y" ]; then
    rm -rf ${WORK_DIR}
fi
</pre>

<h1 id="section-1">録画と再生</h1>

<p>視聴したいチャンネル番号を<a href="http://www.maspro.co.jp/contact/bro/bro_ch.html">マスプロ電工さん</a>のサイトで調べておきましょう。</p>

<pre class="brush: bash; title: ; notranslate" title=""># recpt1 --b25 --strip チャンネル番号 録画時間(秒) ファイル名
# 札幌でNHK総合を30秒録画する例です
recpt1 --b25 --strip 15 30 ./hoge.ts
# 録画時間を指定しない
recpt1 --b25 --strip 15 - ./hoge.ts

# vlcメディアプレイヤーで手軽にリアルタイム視聴
recpt1 --b25 --strip --sid hd 30 - - | cvlc -

# udp配信
recpt1 --udp --addr localhost --port 1234 --b25 --strip 30 - /dev/null
# udp配信しつつ録画
recpt1 --udp --addr localhost --port 1234 --b25 --strip 30 - ./hoge.ts
</pre>

<h1 id="section-2">コンパイルエラー</h1>

<p>上記インストールスクリプトでは __devinitdata, __devinit, __devexit, __devexit_p を削除してから make しエラーを回避しました。</p>

<pre><code># コンパイルエラーのログです
make -C /lib/modules/`uname -r`/build M=`pwd` V=0 modules
make[1]: ディレクトリ `/usr/src/linux-headers-3.8.0-19-generic' に入ります
  CC [M]  ./pt1-b14397800eae/driver/pt1_pci.o
./pt1-b14397800eae/driver/pt1_pci.c:48:23: エラー: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘__devinitdata’
./pt1-b14397800eae/driver/pt1_pci.c:697:22: エラー: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘pt1_pci_init_one’
./pt1-b14397800eae/driver/pt1_pci.c:923:23: エラー: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘pt1_pci_remove_one’
./pt1-b14397800eae/driver/pt1_pci.c:989:12: エラー: ‘pt1_pci_init_one’ がここでは宣言されていません (関数内ではない)
./pt1-b14397800eae/driver/pt1_pci.c:990:2: エラー: 関数 ‘__devexit_p’ の暗黙的な宣言です [-Werror=implicit-function-declaration]
./pt1-b14397800eae/driver/pt1_pci.c:990:25: エラー: ‘pt1_pci_remove_one’ がここでは宣言されていません (関数内ではない)
./pt1-b14397800eae/driver/pt1_pci.c: 関数 ‘pt1_pci_init’ 内:
./pt1-b14397800eae/driver/pt1_pci.c:1002:25: エラー: ‘version’ が宣言されていません (この関数内での最初の使用)
./pt1-b14397800eae/driver/pt1_pci.c:1002:25: 備考: 未宣言の識別子は出現した各関数内で一回のみ報告されます
./pt1-b14397800eae/driver/pt1_pci.c: トップレベル:
./pt1-b14397800eae/driver/pt1_pci.c:182:13: 警告: ‘pt1_thread’ が定義されましたが使用されません [-Wunused-function]
cc1: some warnings being treated as errors
make[2]: *** [./pt1-b14397800eae/driver/pt1_pci.o] エラー 1
make[1]: *** [_module_./pt1-b14397800eae/driver] エラー 2
make[1]: ディレクトリ `/usr/src/linux-headers-3.8.0-19-generic' から出ます
make: *** [pt1_drv.ko] エラー 2
</code></pre>


  </article>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-1 column">
      <ul>
        <li></li>
        <li><a href="mailto:"></a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        
        
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">個人的なメモを兼ねたブログです
</p>
    </div>

  </div>

</footer>


    </body>
</html>